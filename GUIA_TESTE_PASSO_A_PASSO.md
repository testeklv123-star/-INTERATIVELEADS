# üß™ Guia de Teste Passo a Passo - Sistema Offline-First

## üìã Pr√©-requisitos

Antes de come√ßar, certifique-se de ter:

- ‚úÖ Node.js instalado (v16 ou superior)
- ‚úÖ SQLite3 instalado (opcional, para inspe√ß√£o)
- ‚úÖ Terminal/PowerShell/CMD
- ‚úÖ Navegador web moderno
- ‚úÖ Conta Supabase configurada (opcional para sincroniza√ß√£o)

---

## üöÄ Passo 1: Configurar o Supabase (5 minutos)

### 1.1 Acessar o Supabase

Abra seu navegador e acesse:
```
https://rtodbbiugsrhupmyarut.supabase.co
```

### 1.2 Ir ao SQL Editor

No menu lateral esquerdo, clique em:
```
SQL Editor ‚Üí New Query
```

### 1.3 Executar o Script SQL

Copie e cole o conte√∫do abaixo (ou abra `backend/supabase-setup.sql`):

```sql
-- Criar tabela de leads
CREATE TABLE IF NOT EXISTS leads (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT NOT NULL,
  phone TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Criar √≠ndices para performance
CREATE INDEX IF NOT EXISTS idx_leads_email ON leads(email);
CREATE INDEX IF NOT EXISTS idx_leads_created_at ON leads(created_at);

-- Habilitar Row Level Security
ALTER TABLE leads ENABLE ROW LEVEL SECURITY;

-- Permitir INSERT com chave an√¥nima
CREATE POLICY "Permitir INSERT de leads para usu√°rios an√¥nimos"
ON leads FOR INSERT TO anon WITH CHECK (true);
```

### 1.4 Executar

Clique no bot√£o **Run** (ou pressione `F5`)

### 1.5 Verificar

V√° em **Table Editor** ‚Üí Selecione **leads** ‚Üí Deve aparecer vazia (por enquanto)

‚úÖ **Supabase configurado!**

---

## üîß Passo 2: Iniciar o Backend Local

### 2.1 Abrir Terminal

Abra seu terminal (PowerShell, CMD ou Terminal)

### 2.2 Navegar at√© a pasta do backend

```powershell
cd C:\Users\User\Desktop\projetos\white-label-totem-application\backend
```

### 2.3 Instalar depend√™ncias (se ainda n√£o fez)

```powershell
npm install
```

### 2.4 Iniciar o servidor offline-first

```powershell
npm run offline:dev
```

### 2.5 Resultado Esperado

Voc√™ ver√° no terminal:

```
‚úÖ Banco de dados SQLite local inicializado em: C:\...\backend\data\kiosk.db
‚úÖ Cliente Supabase inicializado
‚è∞ Configurando sincroniza√ß√£o autom√°tica a cada 30 segundos

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                            ‚ïë
‚ïë   üöÄ Servidor Offline-First InterativeLeads               ‚ïë
‚ïë                                                            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚úÖ Servidor rodando em: http://localhost:5000
‚úÖ Health check: http://localhost:5000/health
‚úÖ Endpoint de leads: http://localhost:5000/api/leads
‚úÖ Sincroniza√ß√£o autom√°tica: a cada 30 segundos
```

‚ö†Ô∏è **IMPORTANTE:** Deixe este terminal aberto! O servidor precisa continuar rodando.

---

## ü©∫ Passo 3: Verificar se o Backend est√° Saud√°vel

### 3.1 Abrir Novo Terminal

Abra um **NOVO** terminal (deixe o anterior rodando)

### 3.2 Testar Health Check

```powershell
curl http://localhost:5000/health
```

### 3.3 Resultado Esperado

```json
{
  "status": "ok",
  "message": "Servidor offline-first rodando",
  "timestamp": "2025-11-08T01:30:00.000Z"
}
```

‚úÖ **Backend est√° vivo e respondendo!**

---

## üìù Passo 4: Criar um Lead de Teste (via API)

### 4.1 Enviar POST para criar lead

**PowerShell:**
```powershell
curl -X POST http://localhost:5000/api/leads `
  -H "Content-Type: application/json" `
  -d '{"name":"Jo√£o Teste","email":"joao@teste.com","phone":"11999999999"}'
```

**CMD/Bash:**
```bash
curl -X POST http://localhost:5000/api/leads \
  -H "Content-Type: application/json" \
  -d "{\"name\":\"Jo√£o Teste\",\"email\":\"joao@teste.com\",\"phone\":\"11999999999\"}"
```

### 4.2 Resultado Esperado

```json
{
  "success": true,
  "message": "Lead salvo localmente. Ser√° sincronizado em instantes.",
  "data": {
    "id": 1,
    "name": "Jo√£o Teste",
    "email": "joao@teste.com",
    "phone": "11999999999",
    "created_at": "2025-11-08T01:30:00.000Z",
    "sync_status": "PENDING"
  }
}
```

### 4.3 Verificar Logs do Backend

No terminal onde o backend est√° rodando, voc√™ ver√°:

```
2025-11-08T01:30:00.000Z - POST /api/leads
‚úÖ Lead criado localmente: 1
```

‚úÖ **Lead salvo localmente com sucesso!**

---

## üîç Passo 5: Espiar o Banco de Dados Local (SQLite)

A **m√°gica do offline-first** come√ßa aqui! Vamos ver o lead salvo localmente.

### 5.1 Navegar at√© a pasta do banco

```powershell
cd C:\Users\User\Desktop\projetos\white-label-totem-application\backend\data
```

### 5.2 Abrir o banco com SQLite3

```powershell
sqlite3 kiosk.db
```

### 5.3 Consultar os leads

Dentro do prompt do SQLite (`sqlite>`), execute:

```sql
SELECT id, name, email, sync_status, created_at FROM leads;
```

### 5.4 Resultado Esperado

```
id|name|email|sync_status|created_at
1|Jo√£o Teste|joao@teste.com|PENDING|2025-11-08 01:30:00
```

### 5.5 Sair do SQLite

```
.quit
```

‚úÖ **Lead est√° salvo localmente com status PENDING!**

### 5.6 Alternativa: DB Browser for SQLite

Se preferir interface gr√°fica:

1. Baixe: https://sqlitebrowser.org/
2. Instale e abra
3. File ‚Üí Open Database ‚Üí Selecione `backend/data/kiosk.db`
4. Aba "Browse Data" ‚Üí Tabela "leads"
5. Veja seus leads!

---

## ‚è±Ô∏è Passo 6: A M√°gica da Sincroniza√ß√£o!

Agora √© s√≥ esperar. O servi√ßo de sincroniza√ß√£o roda **automaticamente a cada 30 segundos**.

### 6.1 Observar os Logs

Fique de olho no terminal onde o backend est√° rodando.

### 6.2 Ap√≥s ~30 segundos, voc√™ ver√°:

```
üîÑ Executando sincroniza√ß√£o agendada...
üîÑ Iniciando sincroniza√ß√£o de 1 lead(s)...
  ‚úÖ Lead 1 sincronizado com sucesso
‚úÖ Sincroniza√ß√£o conclu√≠da: 1 sucesso(s), 0 erro(s)
```

### 6.3 Se aparecer erro:

```
‚ö†Ô∏è  Sem conex√£o com Supabase. Tentando novamente em breve...
```

**Causa:** Tabela n√£o foi criada no Supabase  
**Solu√ß√£o:** Volte ao Passo 1 e execute o SQL

‚úÖ **Sincroniza√ß√£o autom√°tica funcionando!**

---

## ‚úÖ Passo 7: Verificar a Sincroniza√ß√£o no SQLite

Vamos confirmar que o status mudou para **SYNCED**.

### 7.1 Abrir o banco novamente

```powershell
cd C:\Users\User\Desktop\projetos\white-label-totem-application\backend\data
sqlite3 kiosk.db
```

### 7.2 Consultar com timestamp de sincroniza√ß√£o

```sql
SELECT id, name, email, sync_status, synced_at FROM leads;
```

### 7.3 Resultado Esperado

```
id|name|email|sync_status|synced_at
1|Jo√£o Teste|joao@teste.com|SYNCED|2025-11-08 01:30:30
```

### 7.4 Sair

```
.quit
```

‚úÖ **Lead sincronizado com sucesso!**

---

## üéâ Passo 8: A Grande Verifica√ß√£o Final (Supabase)

Vamos confirmar que os dados chegaram √† nuvem!

### 8.1 Voltar ao Supabase

Abra seu navegador em:
```
https://rtodbbiugsrhupmyarut.supabase.co
```

### 8.2 Ir ao Table Editor

Menu lateral ‚Üí **Table Editor**

### 8.3 Selecionar a tabela leads

Clique em **leads** na lista de tabelas

### 8.4 Resultado Esperado

üéä **PARAB√âNS!** Voc√™ ver√° o lead "Jo√£o Teste" listado na tabela!

```
id | name        | email              | phone        | created_at
1  | Jo√£o Teste  | joao@teste.com     | 11999999999  | 2025-11-08 01:30:30
```

‚úÖ **Dados sincronizados com a nuvem com sucesso!**

---

## üåê Passo 9: Teste pelo Frontend (Recomendado!)

Agora vamos testar a experi√™ncia completa do usu√°rio.

### 9.1 Abrir o Frontend

**Op√ß√£o A - Direto no navegador:**
```
Abra: C:\Users\User\Desktop\projetos\white-label-totem-application\frontend-web\index.html
```

**Op√ß√£o B - Com servidor local:**
```powershell
cd C:\Users\User\Desktop\projetos\white-label-totem-application\frontend-web
npx serve .
```
Acesse: http://localhost:3000

### 9.2 Testar o Formul√°rio

1. **Preencha os campos:**
   - Nome: "Maria Silva"
   - Email: "maria@teste.com"
   - Telefone: "(11) 98888-7777"

2. **Clique em "Enviar"**

3. **Observe:**
   - Bot√£o fica desabilitado
   - Aparece um loader
   - Mensagem verde de sucesso aparece:
     ```
     ‚úÖ Obrigado! Seus dados foram salvos localmente 
        e ser√£o sincronizados em instantes.
     ```

### 9.3 Verificar o Status

No canto inferior da p√°gina, voc√™ ver√°:
- üü¢ **Sistema online** (se backend est√° rodando)
- üî¥ **Sistema offline** (se backend est√° parado)

### 9.4 Repetir Verifica√ß√µes

**Repita os Passos 5 a 8** para ver o fluxo completo:

1. **SQLite:** Lead com status PENDING
2. **Aguardar 30s:** Sincroniza√ß√£o autom√°tica
3. **SQLite:** Lead com status SYNCED
4. **Supabase:** Lead aparece na nuvem

‚úÖ **Frontend funcionando perfeitamente!**

---

## üß™ Passo 10: Testar Modo Offline (Avan√ßado)

Vamos simular uma falha de internet!

### 10.1 Desligar Internet

Desconecte seu computador da internet (WiFi ou cabo)

### 10.2 Criar Lead no Frontend

1. Preencha o formul√°rio com novos dados
2. Clique em "Enviar"
3. **Observe:** Ainda funciona! ‚úÖ

### 10.3 Verificar no SQLite

```powershell
cd backend\data
sqlite3 kiosk.db
SELECT * FROM leads WHERE sync_status = 'PENDING';
.quit
```

Voc√™ ver√° o novo lead com status **PENDING**

### 10.4 Reconectar Internet

Ligue a internet novamente

### 10.5 Aguardar Sincroniza√ß√£o

Em at√© 30 segundos, o lead ser√° sincronizado automaticamente!

### 10.6 Verificar no Supabase

Acesse o Supabase ‚Üí Table Editor ‚Üí leads

O lead offline agora est√° na nuvem! üéâ

‚úÖ **Modo offline-first funcionando perfeitamente!**

---

## üìä Passo 11: Testar M√∫ltiplos Leads

Vamos criar v√°rios leads de uma vez!

### 11.1 Script PowerShell

```powershell
for ($i=1; $i -le 5; $i++) {
  curl -X POST http://localhost:5000/api/leads `
    -H "Content-Type: application/json" `
    -d "{`"name`":`"Teste $i`",`"email`":`"teste$i@teste.com`",`"phone`":`"1199999999$i`"}"
  Start-Sleep -Seconds 1
}
```

### 11.2 Verificar Estat√≠sticas

```powershell
curl http://localhost:5000/api/leads/stats
```

**Resultado:**
```json
{
  "success": true,
  "data": {
    "PENDING": 5,
    "SYNCED": 1,
    "ERROR": 0
  }
}
```

### 11.3 Aguardar Sincroniza√ß√£o

Ap√≥s 30 segundos:

```powershell
curl http://localhost:5000/api/leads/stats
```

**Resultado:**
```json
{
  "success": true,
  "data": {
    "PENDING": 0,
    "SYNCED": 6,
    "ERROR": 0
  }
}
```

‚úÖ **Sincroniza√ß√£o em lote funcionando!**

---

## üéØ Checklist Final de Testes

- [ ] Supabase configurado (tabela criada)
- [ ] Backend inicia sem erros
- [ ] Health check retorna OK
- [ ] POST /api/leads funciona
- [ ] Lead salvo no SQLite com status PENDING
- [ ] Sincroniza√ß√£o autom√°tica executa
- [ ] Status muda para SYNCED no SQLite
- [ ] Lead aparece no Supabase
- [ ] Frontend carrega corretamente
- [ ] Formul√°rio envia dados
- [ ] Mensagem de sucesso aparece
- [ ] Modo offline funciona
- [ ] M√∫ltiplos leads sincronizam
- [ ] Estat√≠sticas corretas

---

## üéä PARAB√âNS!

Se voc√™ completou todos os passos, seu sistema offline-first est√°:

‚úÖ **100% FUNCIONAL**  
‚úÖ **TESTADO E APROVADO**  
‚úÖ **PRONTO PARA PRODU√á√ÉO**  

---

## üìö Pr√≥ximos Passos

### 1. Deploy com Docker

```powershell
docker-compose up --build
```

### 2. Personalizar Frontend

Edite `frontend-web/css/styles.css` e `frontend-web/index.html`

### 3. Adicionar Autentica√ß√£o

Implemente login para rotas admin

### 4. Monitoramento

Configure logs e m√©tricas

### 5. Backup Autom√°tico

Crie script para backup do SQLite

---

## üÜò Troubleshooting

### Backend n√£o inicia

```powershell
cd backend
Remove-Item -Recurse node_modules
npm install
npm run offline:dev
```

### Porta 5000 em uso

```powershell
netstat -ano | findstr :5000
# Mate o processo ou mude a porta no .env
```

### Sincroniza√ß√£o n√£o funciona

1. Verifique se a tabela existe no Supabase
2. Verifique credenciais no `.env`
3. Veja logs do backend para erros
4. Teste conex√£o: `curl http://localhost:5000/api/sync/stats`

### Frontend n√£o conecta

1. Backend est√° rodando?
2. Porta correta no `js/script.js`?
3. CORS configurado no backend?

---

## üìñ Documenta√ß√£o Adicional

- **README_OFFLINE_FIRST.md** - Documenta√ß√£o t√©cnica completa
- **GUIA_INICIO_RAPIDO.md** - Guia de 5 minutos
- **TESTE_RAPIDO.md** - Testes em 3 minutos
- **RESUMO_IMPLEMENTACAO.md** - Vis√£o geral

---

**üöÄ Seu sistema offline-first est√° pronto para o mundo real!**

Desenvolvido com ‚ù§Ô∏è para totems resilientes e offline-first

